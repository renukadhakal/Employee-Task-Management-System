{% extends "base.html" %}
{% block content %}

<h2>Dashboard</h2>

<form method="get" class="mb-4">
  <label for="start_date">Start Date:</label>
  <input type="date" name="start_date" value="{{ start_date }}">
  
  <label for="end_date">End Date:</label>
  <input type="date" name="end_date" value="{{ end_date }}">

  <label for="user">User:</label>
  <select name="user">
    <option value="">All Users</option>
    {% for user in users %}
      <option value="{{ user.id }}" {% if request.GET.user == user.id|stringformat:"s" %}selected{% endif %}>
        {{ user.username }}
      </option>
    {% endfor %}
  </select>

  <button type="submit">Filter</button>
</form>

<!-- Leave Chart -->
<div class="card mb-5">
  <div class="card-header">Leave Summary</div>
  <div class="card-body">
    <canvas id="leaveChart" height="100"></canvas>
  </div>
</div>

<!-- Time Log Chart -->
<div class="card">
  <div class="card-header">Time Log Summary</div>
  <div class="card-body">
    <canvas id="timeLogChart" height="100"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // LEAVE CHART
  const leaveCtx = document.getElementById("leaveChart").getContext("2d");
  const leaveChart = new Chart(leaveCtx, {
    type: "bar",
    data: {
      labels: {{ leave_labels|safe }},
      datasets: {{ leave_datasets|safe }}
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: "Leaves by Month (Stacked by Type)"
        }
      },
      scales: {
        x: { stacked: true },
        y: {
          stacked: true,
          title: { display: true, text: "Leave Count" }
        }
      }
    }
  });

  // TIME LOG CHART
  const timeCtx = document.getElementById("timeLogChart").getContext("2d");
  const timeChart = new Chart(timeCtx, {
    type: "bar",
    data: {
      labels: {{ time_labels|safe }},
      datasets: [
        {
          label: "Work Hours",
          data: {{ work_hours|safe }},
          backgroundColor: "#36A2EB",
          stack: "timelog"
        },
        {
          label: "Holiday Hours",
          data: {{ holiday_hours|safe }},
          backgroundColor: "red",
          stack: "timelog"
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: "Time Logs by Month (Stacked)"
        }
      },
      scales: {
        x: { stacked: true },
        y: {
          stacked: true,
          title: { display: true, text: "Hours" }
        }
      }
    }
  });
</script>

{% endblock %}
